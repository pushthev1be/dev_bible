{"type":"PRINCIPLE","id":"p.controllers_thin","text":"Controllers are thin; orchestration lives in services.","tags":["architecture","backend"]}
{"type":"PRINCIPLE","id":"p.fail_fast","text":"Validate inputs at API boundaries and fail fast with clear error messages.","tags":["architecture","api"]}
{"type":"PRINCIPLE","id":"p.single_source_truth","text":"Database is the single source of truth; cache and derived data must be rebuildable.","tags":["architecture","database"]}
{"type":"PATTERN","id":"pat.two_phase_delete.v1","name":"Two-phase delete","when":"External asset + local DB","steps":["delete external resource","verify deletion succeeded","delete DB record","invalidate cache"],"tags":["consistency","storage"]}
{"type":"PATTERN","id":"pat.retry_with_backoff.v1","name":"Retry with exponential backoff","when":"External API calls that may fail transiently","steps":["try request","on failure wait 2^attempt seconds","retry up to max_attempts","log final failure"],"tags":["reliability","api"]}
{"type":"PATTERN","id":"pat.pagination_standard.v1","name":"Standard pagination","when":"Listing resources","steps":["accept page and limit params","validate limit <= max","return {items, total, page, limit}","include next/prev URLs"],"tags":["api","ux"]}
{"type":"MISTAKE","id":"m.auth_bypass.2025-10-16","symptom":"Login bypass via demo path","root_cause":"Fallback demo token was still active in production","fix_steps":["require JWT on all protected routes","remove demo fallback code","add auth integration tests"],"tags":["auth","security"]}
{"type":"MISTAKE","id":"m.sql_injection.2025-10-15","symptom":"User input in raw SQL query","root_cause":"Used string interpolation instead of parameterized queries","fix_steps":["replace with parameterized queries","audit all DB calls","add SQL injection tests"],"tags":["security","database"]}
{"type":"MISTAKE","id":"m.race_condition_wallet.2025-10-14","symptom":"Double-spend in wallet system","root_cause":"No transaction isolation on balance checks","fix_steps":["wrap check+update in DB transaction","use SELECT FOR UPDATE","add concurrency tests"],"tags":["database","concurrency","wallet"]}
{"type":"MISTAKE","id":"m.cors_blocked.2025-10-13","symptom":"Frontend cannot call backend API","root_cause":"CORS not configured for production domain","fix_steps":["add production domain to allowed origins","test from actual deployed frontend","document CORS settings"],"tags":["deployment","api","cors"]}
{"type":"MISTAKE","id":"m.env_vars_missing.2025-10-12","symptom":"Deployed app crashes on startup","root_cause":"Environment variables not set in production","fix_steps":["document all required env vars in README","add startup validation","fail fast with clear error message"],"tags":["deployment","config"]}
{"type":"RUNBOOK","id":"rb.add_endpoint.v1","title":"Add new API endpoint","steps":["define route in routes file","implement service method with business logic","add input validation","write unit tests","add to API documentation","update bible with any patterns"],"tags":["api","development"]}
{"type":"RUNBOOK","id":"rb.deploy_backend.v1","title":"Deploy backend to production","steps":["run tests locally","update dependencies in pyproject.toml","commit and push changes","deploy using deploy tool","check logs for errors","test deployed endpoints"],"tags":["deployment","backend"]}
{"type":"RUNBOOK","id":"rb.investigate_bug.v1","title":"Investigate production bug","steps":["collect error logs and reproduce steps","search bible for similar mistakes","add logging if needed","fix root cause not symptoms","add regression test","document as MISTAKE in bible"],"tags":["debugging","process"]}
{"type":"DECISION","id":"d.storage_choice.2025-10","question":"Where to store user uploads?","decision":"Cloud vendor X with CDN","reason":"Built-in CDN, automatic lifecycle policies, and better pricing than alternatives","tags":["infra","storage"]}
{"type":"DECISION","id":"d.framework_fastapi.2025-10","question":"Which Python web framework?","decision":"FastAPI","reason":"Built-in async support, automatic OpenAPI docs, and excellent type hints integration","tags":["backend","framework"]}
{"type":"DECISION","id":"d.database_postgres.2025-10","question":"Which database for main data?","decision":"PostgreSQL","reason":"ACID compliance, JSON support, mature ecosystem, and excellent performance","tags":["database","infra"]}
